# TCP通信功能使用指南

本功能基于OpenFrp API实现了TCP协议的网络通信，允许不同网络的其他设备通过互联网连接到本地的TCP服务。

## 功能概述

- **用户认证**: 通过OpenFrp token进行身份验证
- **节点选择**: 支持选择不同的OpenFrp节点创建隧道
- **TCP隧道**: 创建和管理TCP类型的网络隧道
- **自动下载**: 自动下载和配置frpc客户端
- **状态监控**: 实时监控隧道状态和连接情况

## 快速开始

### 1. 访问TCP通信功能

1. 启动CABM应用
2. 在主页点击"**TCP通信**"按钮
3. 进入TCP通信配置页面

### 2. 用户登录

1. 在"OpenFrp 登录"部分输入您的用户token
2. 点击"登录"按钮
3. 登录成功后，创建隧道和隧道列表部分将变为可用状态

### 3. 创建TCP隧道

1. 在"创建TCP隧道"部分填写以下信息：
   - **隧道名称**: 为您的隧道设置一个易记的名称
   - **本地地址**: 本地服务的IP地址（通常为127.0.0.1）
   - **本地端口**: 本地服务监听的端口号
   - **远程端口**: 远程访问时使用的端口号
2. 从节点列表中选择一个可用的节点
3. 点击"创建隧道"按钮

### 4. 管理隧道

- **查看隧道**: 在"隧道列表"部分查看所有已创建的隧道
- **启动隧道**: 点击"启动"按钮启动frpc客户端
- **停止隧道**: 点击"停止"按钮停止frpc进程
- **删除隧道**: 点击"删除"按钮永久删除隧道

## 详细说明

### OpenFrp Token获取

1. 访问 [OpenFrp官网](https://console.openfrp.net)
2. 登录您的账户
3. 在个人中心找到"第三方客户端安全登录"
4. 复制Authorization token

### 节点选择建议

- **香港节点**: 延迟低，适合亚洲用户
- **美国节点**: 适合跨洲际连接
- **欧洲节点**: 适合欧洲地区用户
- 选择节点时请考虑：
  - 网络延迟
  - 节点状态（必须为200状态）
  - 节点带宽限制

### 端口配置

- **本地端口**: 您的本地服务实际监听的端口
- **远程端口**: 外部访问时使用的端口
- 注意：远程端口必须在节点允许的端口范围内

### 安全注意事项

1. 妥善保管您的OpenFrp token，不要泄露给他人
2. 合理配置本地服务权限，避免安全风险
3. 定期检查隧道状态，确保连接正常
4. 及时停止不需要的隧道，节省资源

## 故障排除

### 常见问题

1. **登录失败**
   - 检查token是否正确
   - 确认网络连接正常
   - 查看浏览器控制台错误信息

2. **创建隧道失败**
   - 确认节点状态正常
   - 检查端口是否已被占用
   - 验证本地端口是否正确

3. **启动隧道失败**
   - 确认frpc客户端已下载完成
   - 检查系统权限
   - 查看日志文件

4. **连接不稳定**
   - 尝试更换节点
   - 检查网络环境
   - 重启frpc客户端

### 日志查看

- frpc日志保存在 `frpc/frpc.log` 文件中
- 系统日志可在控制台输出中查看

## 技术实现

### 系统架构

- **前端界面**: 基于HTML/CSS/JavaScript的Web界面
- **后端服务**: Flask框架处理API请求
- **OpenFrp集成**: 通过REST API与OpenFrp服务交互
- **frpc客户端**: 自动下载和管理OpenFrp客户端
- **配置管理**: JSON格式的本地配置文件

### API接口

- `GET /api/tcp/status`: 获取登录状态
- `POST /api/tcp/login`: 用户登录
- `GET /api/tcp/nodes`: 获取节点列表
- `GET /api/tcp/tunnels`: 获取隧道列表
- `POST /api/tcp/create`: 创建TCP隧道
- `POST /api/tcp/start/<id>`: 启动隧道
- `POST /api/tcp/stop/<id>`: 停止隧道
- `DELETE /api/tcp/remove/<id>`: 删除隧道

### 配置文件

- `tcp_config.json`: 存储用户配置和隧道信息
- `frpc/frpc.ini`: frpc客户端配置文件（自动生成）

## 扩展功能

未来可能添加的功能：

- UDP隧道支持
- HTTP/HTTPS隧道支持
- 批量隧道管理
- 流量监控和统计
- 自动重连功能
- 负载均衡配置

## 贡献与反馈

如果您在使用过程中遇到问题或有改进建议，请：

1. 查看本使用文档
2. 检查常见问题解答
3. 提交Issue或Pull Request

---

**注意**: 本功能基于OpenFrp开放API开发，请遵守OpenFrp的服务条款和使用协议。